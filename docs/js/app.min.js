!function(){"use strict";var o=function(){GlslCanvas.prototype.TEXTURE_COUNT=0,GlslCanvas.prototype.BUFFER_COUNT=0,GlslCanvas.prototype.createBuffer=function(e,r){var t=this,a=t.gl,n=t.TEXTURE_COUNT+t.BUFFER_COUNT;t.BUFFER_COUNT++,a.activeTexture(a.TEXTURE0+n);var i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,r,0,a.RGBA,a.UNSIGNED_BYTE,null);var o=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,o),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),a.viewport(0,0,w,h),a.clear(a.COLOR_BUFFER_BIT),{index:n,texture:i,buffer:o}},GlslCanvas.prototype.createSwappableBuffer=u,GlslCanvas.prototype.loadBuffers=function(e){var r=this,t=r.gl;r.buffers={};var a=l(r,r.vertexString,t.VERTEX_SHADER);for(var n in e){var i=e[n],o=l(r,i.common+i.fragment,t.FRAGMENT_SHADER);o?r.isValid=!0:(o=l(r,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",t.FRAGMENT_SHADER),r.isValid=!1);var s=f(r,[a,o]);i.program=s,i.bundle=u(r.canvas.width,r.canvas.height),r.buffers[n]=i,t.deleteShader(o),0}t.deleteShader(a)},GlslCanvas.prototype.loadUniforms=function(e){if(e.textures)for(var r in e.textures)glsl.uniformTexture("u_texture_"+r,e.textures[r],{filtering:"mipmap",repeat:!0})},GlslCanvas.prototype.updateVariables=function(){var e=this,r=(e.gl,new Date),t=performance.now();e.variables=e.variables||{},e.variables.prev=e.variables.prev||t,e.variables.delta=(t-e.variables.prev)/1e3,e.variables.prev=t,e.variables.load=e.timeLoad,e.variables.time=(t-e.timeLoad)/1e3,e.variables.year=r.getFullYear(),e.variables.month=r.getMonth(),e.variables.date=r.getDate(),e.variables.daytime=3600*r.getHours()+60*r.getMinutes()+r.getSeconds()+.001*r.getMilliseconds()},GlslCanvas.prototype.UpdateUniforms=function(e,r){var t=this,a=t.gl;a.useProgram(e),a.uniform2f(a.getUniformLocation(e,"u_resolution"),t.canvas.width,t.canvas.height),1<t.nTime&&a.uniform1f(a.getUniformLocation(e,"u_time"),t.variables.time);1<t.nDelta&&a.uniform1f(a.getUniformLocation(e,"u_delta"),t.variables.delta);t.nDate&&a.uniform4f(a.getUniformLocation(e,"u_date"),t.variables.year,t.variables.month,t.variables.date,t.variables.daytime);var n=0;for(var r in t.buffers)a.uniform1i(a.getUniformLocation(e,"u_buffer_"+n),t.buffers[r].bundle.input.index),n++},GlslCanvas.prototype.resizeBuffers=function(){var e=this,r=e.gl;if(e.buffers&&0<Object.keys(e.buffers).length){var t=0,a=r.canvas.width,n=r.canvas.height;for(var i in r.viewport(0,0,a,n),e.buffers){var o=e.buffers[i];r.useProgram(o.program),r.activeTexture(r.TEXTURE0+2*t),r.bindTexture(r.TEXTURE_2D,o.bundle.textureOut),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,a,n,0,r.RGBA,r.UNSIGNED_BYTE,null),r.activeTexture(r.TEXTURE0+2*t+1),r.bindTexture(r.TEXTURE_2D,o.bundle.textureIn),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,a,n,0,r.RGBA,r.UNSIGNED_BYTE,null),t++}r.useProgram(e.program)}},GlslCanvas.prototype.renderGl=function(){var e=this,r=e.gl,t=r.canvas.width,a=r.canvas.height;if(e.updateVariables(),r.viewport(0,0,t,a),e.buffers&&0<Object.keys(e.buffers).length){for(var n in e.buffers){var i=e.buffers[n];e.UpdateUniforms(i.program,n),i.bundle.render(t,a,i.program)}r.bindFramebuffer(r.FRAMEBUFFER,null)}e.UpdateUniforms(e.program,"main"),r.drawArrays(r.TRIANGLES,0,6)},GlslCanvas.prototype.render=function(){var e=this;e.gl;e.visible=(r=e.canvas,0<r.getBoundingClientRect().top+r.height&&r.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)),(e.forceRender||e.animated&&e.visible&&!e.paused)&&(e.renderGl(),e.change=!1,e.forceRender=!1,e.trigger("render",{}));var r};GlslCanvas.prototype.setMouse;GlslCanvas.prototype.setMouse=function(e){var r=this,t=r.gl,a=this.canvas.getBoundingClientRect();if(e&&e.x&&e.x>=a.left&&e.x<=a.right&&e.y&&e.y>=a.top&&e.y<=a.bottom){var n=e.x-a.left,i=this.canvas.height-(e.y-a.top);if(r.buffers&&0<Object.keys(r.buffers).length)for(var o in r.buffers){var s=r.buffers[o];t.useProgram(s.program),t.uniform2f(t.getUniformLocation(s.program,"u_mouse"),n,i)}t.useProgram(r.program),t.uniform2f(t.getUniformLocation(r.program,"u_mouse"),n,i)}};var e=GlslCanvas.prototype.resize;function u(e,r){var t=this,a=t.gl,n=t.createBuffer(e,r),i=t.createBuffer(e,r);return{input:n,output:i,swap:function(){var e=n;n=i,i=e,this.input=n,this.output=i},render:function(e,r,t){a.useProgram(t),a.bindFramebuffer(a.FRAMEBUFFER,n.buffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i.texture,0),a.activeTexture(i.index),a.bindTexture(a.TEXTURE_2D,i.texture),a.viewport(0,0,e,r),a.drawArrays(a.TRIANGLES,0,6),a.activeTexture(n.index),a.bindTexture(a.TEXTURE_2D,n.texture),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,e,r,0),this.swap()}}}function l(e,r,t){var a=e.gl,n=a.createShader(t);if(a.shaderSource(n,r),a.compileShader(n),!a.getShaderParameter(n,a.COMPILE_STATUS)){var i=a.getShaderInfoLog(n);return console.error("*** Error compiling shader "+n+":"+i),e.trigger("error",{shader:n,source:r,type:t,error:i}),a.deleteShader(n),null}return n}function f(e,r,t,a){var n,i=e.gl,o=i.createProgram();for(n=0;n<r.length;++n)i.attachShader(o,r[n]);if(t)for(n=0;n<t.length;++n)i.bindAttribLocation(o,a?a[n]:n,t[n]);if(i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS)){var s=i.getProgramInfoLog(o);return console.log("Error in program linking:"+s),i.deleteProgram(o),null}return o.blit=(i.useProgram(o),i.bindBuffer(i.ARRAY_BUFFER,i.createBuffer()),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,i.createBuffer()),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),i.STATIC_DRAW),i.vertexAttribPointer(0,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(0),function(e){i.bindFramebuffer(i.FRAMEBUFFER,e),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}),o}return GlslCanvas.prototype.resize=function(){return e.apply(this)},function(e,r){return new GlslCanvas(e,r)}}(),n=window.options={vertex:"",fragment:"",main:"",buffers:{}};function s(i){console.log("onGlslError.error",i.error);var o=window.options,s=[],u=[];i.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,r,t,a){var n="ERROR ("+t+") "+a,i='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([o.uri,Number(r),n]))+'"><span class="line">ERROR line '+Number(r)+'</span> <span class="value" title="'+t+'">'+t+'</span> <span class="text" title="'+a+'">'+a+"</span></a></li>";return s.push(i),i}),i.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(e,r,t,a){var n='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([o.uri,Number(r),i]))+'"><span class="line">WARN line '+Number(r)+'</span> <span class="text" title="'+a+'">'+a+"</span></a></li>";return u.push(n),n});var e='<div class="errors-content"><p>glslCanvas error</p><ul>';e+=s.join("\n"),e+=u.join("\n"),e+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=e,document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",function(){var e,r,t;e="shaders/buffers/milk.glsl",r=function(e){for(var r in e=(e=e.replace(new RegExp("(/{2} u_buffer_)(\\d+).*((.|\\n)*?)(?=/{2} u_buffer|/{2} main|$)","g"),function(e,r,t,a){return n.buffers["u_buffer_"+t]={fragment:a},""})).replace(new RegExp("(/{2} main).*((.|\\n)*)(?=/{2} u_buffer|$)","g"),function(e,r,t){return n.main=t,""}),n.buffers)n.buffers[r].common=e;n.fragment=e+(n.main||""),function(){var a=document.querySelector(".content"),n=document.querySelector(".shader");t(!0);var e,r,i=new o(n,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});function t(e){var r=a.offsetWidth,t=a.offsetHeight;n.style.width=r+"px",n.style.height=t+"px",e?(n.width=r,n.height=t):i.resize()}i.animated=!0,i.on("error",s),i.on("render",function(){}),r=window.options,document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class","welcome"),r.vertex=0<r.vertex.trim().length?r.vertex:null,r.fragment=0<r.fragment.trim().length?r.fragment:null,r.fragment||r.vertex?document.querySelector("body").setAttribute("class","ready"):document.querySelector("body").setAttribute("class","empty"),i.load(r.fragment,r.vertex),i.loadBuffers(r.buffers),i.loadUniforms(r),window.addEventListener("resize",function(){e&&clearTimeout(e),e=setTimeout(t,50)}),t()}()},(t=new XMLHttpRequest).open("GET",e,!0),t.addEventListener("load",function(){r(t.responseText)}),t.send()})}();
//# sourceMappingURL=app.min.js.map
