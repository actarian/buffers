!function(){"use strict";var i=function(){function u(e,r,t){var n=e.gl,a=n.createShader(t);if(n.shaderSource(a,r),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS)){var o=n.getShaderInfoLog(a);return console.error("*** Error compiling shader "+a+":"+o),e.trigger("error",{shader:a,source:r,type:t,error:o}),n.deleteShader(a),null}return a}function f(e,r,t,n){var a,o=e.gl,i=o.createProgram();for(a=0;a<r.length;++a)o.attachShader(i,r[a]);if(t)for(a=0;a<t.length;++a)o.bindAttribLocation(i,n?n[a]:a,t[a]);if(o.linkProgram(i),!o.getProgramParameter(i,o.LINK_STATUS)){var s=o.getProgramInfoLog(i);return console.log("Error in program linking:"+s),o.deleteProgram(i),null}return i}return GlslCanvas.prototype.loadBuffers=function(e){var r=this,s=r.gl,t=0;r.buffers={},s.bundle=function(e,r,t,n){s.useProgram(e);var a=s.createTexture(),o=s.createFramebuffer(),i=s.getUniformLocation(e,"u_buffer_"+r);return s.bindTexture(s.TEXTURE_2D,a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,n,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),{texture:a,buffer:o,uniform:i,link:function(){s.useProgram(e),s.bindFramebuffer(s.FRAMEBUFFER,o),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,a,0),s.viewport(0,0,t,n),s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,a)}}};var n=u(r,r.vertexString,s.VERTEX_SHADER);for(var a in e){var o=e[a],i=u(r,o.common+o.fragment,s.FRAGMENT_SHADER);i?r.isValid=!0:(i=u(r,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",s.FRAGMENT_SHADER),r.isValid=!1);var l=f(r,[n,i]);o.program=l,o.bundle=s.bundle(l,t,r.canvas.width,r.canvas.height),r.buffers[a]=o,s.deleteShader(i),t++}s.deleteShader(n)},GlslCanvas.prototype.loadUniforms=function(e){if(e.textures)for(var r in e.textures)glsl.uniformTexture("u_texture_"+r,e.textures[r],{filtering:"mipmap",repeat:!0})},GlslCanvas.prototype.updateVariables=function(){var e=this,r=(e.gl,new Date),t=performance.now();e.variables=e.variables||{},e.variables.prev=e.variables.prev||t,e.variables.delta=(t-e.variables.prev)/1e3,e.variables.prev=t,e.variables.load=e.timeLoad,e.variables.time=(t-e.timeLoad)/1e3,e.variables.year=r.getFullYear(),e.variables.month=r.getMonth(),e.variables.date=r.getDate(),e.variables.daytime=3600*r.getHours()+60*r.getMinutes()+r.getSeconds()+.001*r.getMilliseconds()},GlslCanvas.prototype.updateUniforms=function(e,r){var t=this,n=t.gl;n.uniform1f(n.getUniformLocation(e,"u_time"),t.variables.time),n.uniform2f(n.getUniformLocation(e,"u_resolution"),t.canvas.width,t.canvas.height);var a=0;for(var o in t.buffers)n.uniform1i(n.getUniformLocation(e,"u_buffer_"+a),a),a++},GlslCanvas.prototype.updateBuffers=function(){var e=this,r=e.gl;if(e.buffers&&0<Object.keys(e.buffers).length){for(var t in e.buffers){var n=e.buffers[t];r.useProgram(n.program),e.updateUniforms(n.program,t),n.bundle.link(),r.drawArrays(r.TRIANGLES,0,6)}r.useProgram(e.program),e.updateUniforms(e.program,"main"),r.bindFramebuffer(r.FRAMEBUFFER,null),r.viewport(0,0,r.canvas.width,r.canvas.height)}},GlslCanvas.prototype.uniform=function(e,r,t,n){var a=this,o=a.gl,i=Array.prototype.slice.call(arguments).slice(3);a.uniforms=a.uniforms||{},a.uniforms[n]=a.uniforms[n]||{};var s=a.uniforms[n];s.name=n,s.value=i,s.type=t,s.method="uniform"+r,s.location=o.getUniformLocation(e,n),o[s.method].apply(o,[s.location].concat(s.value));return s},GlslCanvas.prototype.render=function(){var e=this,r=e.gl;e.visible=(t=e.canvas,0<t.getBoundingClientRect().top+t.height&&t.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)),e.animated=!0,(e.forceRender||e.animated&&e.visible&&!e.paused)&&(e.updateVariables(),e.updateBuffers(),r.drawArrays(r.TRIANGLES,0,6),e.trigger("render",{}),e.change=!1,e.forceRender=!1);var t},function(e,r){return new GlslCanvas(e,r)}}(),a=window.options={vertex:"",fragment:"",main:"",buffers:{}};function s(o){console.log("onGlslError.error",o.error);var i=window.options,s=[],l=[];o.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,r,t,n){var a="ERROR ("+t+") "+n,o='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([i.uri,Number(r),a]))+'"><span class="line">ERROR line '+Number(r)+'</span> <span class="value" title="'+t+'">'+t+'</span> <span class="text" title="'+n+'">'+n+"</span></a></li>";return s.push(o),o}),o.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(e,r,t,n){var a='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([i.uri,Number(r),o]))+'"><span class="line">WARN line '+Number(r)+'</span> <span class="text" title="'+n+'">'+n+"</span></a></li>";return l.push(a),a});var e='<div class="errors-content"><p>glslCanvas error</p><ul>';e+=s.join("\n"),e+=l.join("\n"),e+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=e,document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",function(){var e,r,t;e="shaders/buffers.glsl",r=function(e){for(var r in e=(e=e.replace(new RegExp("(/{2} u_buffer_)(\\d+).*((.|\\n)*?)(?=/{2} [u_buffer|main]|\\z)","g"),function(e,r,t,n){return a.buffers["u_buffer_"+t]={fragment:n},""})).replace(new RegExp("(/{2} main).*((.|\\n)*)(?=/{2} u_buffer|$)","g"),function(e,r,t){return a.main=t,""}),a.buffers)a.buffers[r].common=e;a.fragment=e+(a.main||""),function(){var n=document.querySelector(".content"),a=document.querySelector(".shader");t(!0);var e,r,o=new i(a,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});function t(e){var r=n.offsetWidth,t=n.offsetHeight;a.style.width=r+"px",a.style.height=t+"px",e?(a.width=r,a.height=t):o.resize()}o.animated=!0,o.on("error",s),o.on("render",function(){o.forceRender=!0}),r=window.options,document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class","welcome"),r.vertex=0<r.vertex.trim().length?r.vertex:null,r.fragment=0<r.fragment.trim().length?r.fragment:null,r.fragment||r.vertex?document.querySelector("body").setAttribute("class","ready"):document.querySelector("body").setAttribute("class","empty"),o.load(r.fragment,r.vertex),o.loadBuffers(r.buffers),o.loadUniforms(r),window.addEventListener("resize",function(){e&&clearTimeout(e),e=setTimeout(t,50)}),t()}()},(t=new XMLHttpRequest).open("GET",e,!0),t.addEventListener("load",function(){r(t.responseText)}),t.send()})}();
//# sourceMappingURL=app.min.js.map
