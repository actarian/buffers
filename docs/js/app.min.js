!function(){"use strict";var a=window.options={vertex:"",fragment:"",main:"",buffers:{}};function l(o){console.log("onGlslError.error",o.error);var i=window.options,l=[],s=[];o.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,r,t,n){var a="ERROR ("+t+") "+n,o='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([i.uri,Number(r),a]))+'"><span class="line">ERROR line '+Number(r)+'</span> <span class="value" title="'+t+'">'+t+'</span> <span class="text" title="'+n+'">'+n+"</span></a></li>";return l.push(o),o}),o.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(e,r,t,n){var a='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([i.uri,Number(r),o]))+'"><span class="line">WARN line '+Number(r)+'</span> <span class="text" title="'+n+'">'+n+"</span></a></li>";return s.push(a),a});var e='<div class="errors-content"><p>glslCanvas error</p><ul>';e+=l.join("\n"),e+=s.join("\n"),e+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=e,document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",function(){var e,r,t;e="shaders/buffers.glsl",r=function(e){for(var r in e=e.replace(new RegExp("(/{2} u_buffer_)(\\d+).*((.|\\n)*?)(?=/{2} [u_buffer|main]|\\z)","g"),function(e,r,t,n){return a.buffers["u_buffer_"+t]={fragment:n},""}),console.log("fragment-------",e),e=e.replace(new RegExp("(/{2} main)((.|\\n)*?)(?=/{2} u_buffer|\\z)","g"),function(e,r,t){return console.log("main.replace---------",arguments),a.main=t,""}),console.log("getResource-------",e,a.buffers),a.buffers)a.buffers[r].common=e;a.fragment=e+(a.main||""),function(){var n=document.querySelector(".content"),a=document.querySelector(".shader");r(!0);var e,o=new GlslCanvas(a,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});function r(e){var r=n.offsetWidth,t=n.offsetHeight;a.style.width=r+"px",a.style.height=t+"px",e?(a.width=r,a.height=t):o.resize()}o.on("error",l),o.on("render",function(){o.forceRender=!0}),function(){var e=window.options;if(document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class","welcome"),e.vertex=0<e.vertex.trim().length?e.vertex:null,e.fragment=0<e.fragment.trim().length?e.fragment:null,e.fragment||e.vertex?document.querySelector("body").setAttribute("class","ready"):document.querySelector("body").setAttribute("class","empty"),o.load(e.fragment,e.vertex),o.loadBuffers(e.buffers),e.textures)for(var r in e.textures)o.uniformTexture("u_texture_"+r,e.textures[r],{filtering:"mipmap",repeat:!0});console.log("glsl",o)}(),window.addEventListener("resize",function(){e&&clearTimeout(e),e=setTimeout(r,50)}),r()}()},(t=new XMLHttpRequest).open("GET",e,!0),t.addEventListener("load",function(){r(t.responseText)}),t.send()});!function(){function u(e,r,t,n,a,o,i,l){e.activeTexture(e.TEXTURE0+r);var s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,a,t,n,0,o,i,null);var u=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.viewport(0,0,t,n),e.clear(e.COLOR_BUFFER_BIT),[s,u,r]}function f(e,r,t){var n=e.gl,a=n.createShader(t);if(n.shaderSource(a,r),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS)){var o=n.getShaderInfoLog(a);return console.error("*** Error compiling shader "+a+":"+o),e.trigger("error",{shader:a,source:r,type:t,error:o}),n.deleteShader(a),null}return a}function c(e,r,t,n){var a,o=e.gl,i=o.createProgram();for(a=0;a<r.length;++a)o.attachShader(i,r[a]);if(t)for(a=0;a<t.length;++a)o.bindAttribLocation(i,n?n[a]:a,t[a]);return o.linkProgram(i),o.getProgramParameter(i,o.LINK_STATUS)?i:(lastError=o.getProgramInfoLog(i),console.log("Error in program linking:"+lastError),o.deleteProgram(i),null)}GlslCanvas.prototype.render=function(){var e=this,r=e.gl;if(e.visible=(l=e.canvas,0<l.getBoundingClientRect().top+l.height&&l.getBoundingClientRect().top<(window.innerHeight||document.documentElement.clientHeight)),e.forceRender||e.animated&&e.visible&&!e.paused){var t=new Date,n=performance.now();for(var a in e.timeDelta=(n-e.timePrev)/1e3,e.timePrev=n,1<e.nDelta&&e.uniform("1f","float","u_delta",e.timeDelta),1<e.nTime&&e.uniform("1f","float","u_time",(n-e.timeLoad)/1e3),e.nDate&&e.uniform("4f","float","u_date",t.getFullYear(),t.getMonth(),t.getDate(),3600*t.getHours()+60*t.getMinutes()+t.getSeconds()+.001*t.getMilliseconds()),e.uniform("2f","vec2","u_resolution",e.canvas.width,e.canvas.height),e.texureIndex=0,e.textures)e.uniformTexture(a);if(e.buffers&&0<Object.keys(e.buffers).length){for(var o in e.buffers){var i=e.buffers[o];e.uniformTexture(o,i.frame[0],{filtering:"mipmap",repeat:!0}),r.useProgram(i.program),r.binder(i.frame)}r.useProgram(e.program)}r.drawArrays(r.TRIANGLES,0,6),e.trigger("render",{}),e.change=!1,e.forceRender=!1}var l},GlslCanvas.prototype.loadBuffers=function(e){var r=this,t=r.gl;r.buffers={};var n=f(r,r.vertexString,t.VERTEX_SHADER);for(var a in e){var o=e[a],l=f(r,o.common+o.fragment,t.FRAGMENT_SHADER);l?(r.isValid=!0,o.frame=u(t,i,r.canvas.width,r.canvas.height,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,t.NEAREST)):(l=f(r,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",t.FRAGMENT_SHADER),r.isValid=!1);var s=c(r,[n,l]);o.program=s,console.log("buffer",o),r.buffers[a]=o,t.deleteShader(l)}t.deleteShader(n),t.binder=(t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(0),function(e){t.bindFramebuffer(t.FRAMEBUFFER,e),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})}}()}();
//# sourceMappingURL=app.min.js.map
